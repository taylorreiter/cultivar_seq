### Digital Normalization
Activate the environment in which khmer was installed
```
source ~/pondenv/bin/activate
```
Link in qc'd reads from paired and single in data. These are both in folders named quality, so all reads should be linked in this way. 
```
cd /mnt/work/
mkdir eelpond
cd eelpond
mkdir -p diginorm
cd diginorm
ln -s ../../quality/*.qc.fq.gz .
```
khmer will expect all reads to be paired end, except one file that contains "orphaned" reads that are single end. This is the orphan file created during preprocessing. Concatenate the orphan file to the single end fastq files. 
```
gunzip -c orphan* SRR* > orphaned-and-single-reads.qc.fq.gz
```
Apply digital normailzation
```
normalize-by-median.py -p -k 20 -C 20 -M 4e9 \
 --savegraph normC20k20.ct -u orphaned-and-single-reads.qc.fq.gz \
 *.pe.qc.fq.gz
```

Trim erroneous kmers
```
filter-abund.py -V -Z 18 normC20k20.ct *.keep && \
  rm *.keep normC20k20.ct
```

DIB Eel Pond Renaming suggestion -- think more about how to handle the renaming of files after output files are created. 
```
for file in *.pe.*.abundfilt
do
  extract-paired-reads.py ${file} && \
        rm ${file}
done
```
We can combine all of the orphaned reads into a single file
```
gzip -9c orphans.qc.fq.gz.keep.abundfilt > orphans.keep.abundfilt.fq.gz && \
   rm orphans.qc.fq.gz.keep.abundfilt
for file in *.pe.*.abundfilt.se
do
   gzip -9c ${file} >> orphans.keep.abundfilt.fq.gz && \
       rm ${file}
done
```
We can also rename the remaining PE reads & compress those files
```
for file in *.abundfilt.pe
do
  newfile=${file%%.fq.gz.keep.abundfilt.pe}.keep.abundfilt.fq
  mv ${file} ${newfile}
  gzip ${newfile}
done
```
This leaves you with a bunch of files named \*.keep.abundfilt.fq.gz, which represent the paired-end/interleaved reads that remain after both digital normalization and error trimming, together with orphans.keep.abundfilt.fq.gz

