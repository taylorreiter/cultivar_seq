# In my further attempt to ID things that are not olive in these samples, I am trying sourmash SBT_gather "using microbes.sbt.json". 
# CSV listing what is in the SBT (NB SBT stands for sequence bloom tree)
# https://s3-us-west-1.amazonaws.com/spacegraphcats.ucdavis.edu/sra-bacteria-wgs-360k.categories.csv.gz
# Actual file containing the SBT signatures
# http://spacegraphcats.ucdavis.edu.s3.amazonaws.com/2017-01-18-microbial-wgs-sigs.tar.gz

# Outline
    # Unmount AWS instance with data. 
    # Create new AWS instance. 
    # download sourmash, SBT signatures, etc. 
    # Mount drive 
    # Run Sourmash on reads that did not align to the olive reference genome (~18% of the original fastq files). 

# Commence!

sudo apt-get update && \
sudo apt-get -y install screen git curl gcc make g++ python-dev unzip \
        default-jre pkg-config libncurses5-dev r-base-core r-cran-gplots \
        python-matplotlib python-pip python-virtualenv sysstat fastqc \
        trimmomatic bowtie samtools blast2 wget bowtie2 openjdk-8-jre \
        hmmer ruby
        
# Install khmer        
pip install khmer

# check that trim-low-abund.py is functional

# Install sourmash
pip install sourmash

# Install 
mkdir sourmash_SBTs
wget http://spacegraphcats.ucdavis.edu.s3.amazonaws.com/microbe-sbt-k21-2016-11-27.tar.gz
wget http://spacegraphcats.ucdavis.edu.s3.amazonaws.com/microbe-sbt-k31-2016-11-27.tar.gz
wget http://spacegraphcats.ucdavis.edu.s3.amazonaws.com/microbe-sbt-k51-2016-11-27.tar.gz
tar -xzvf microbe-sbt-k21-2016-11-27.tar.gz
tar -xzvf microbe-sbt-k31-2016-11-27.tar.gz
tar -xzvf microbe-sbt-k51-2016-11-27.tar.gz

# mount the directory
lsblk
sudo mount /dev/xvdf1 /mnt/

# Trim low abundance k-mers using khmer
trim-low-abund.py -k 21 -C 2 --variable-coverage --gzip /mnt/work/hisat/unaligned/*.fastq.gz

# Compute signatures on fastq files

    
